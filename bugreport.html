<!--<?php
	$pageNum = 4;
	$pageName = "Bug report";
	require_once("./basicChanges.php");
?>-->

<script>
	document.title = "JS+ Library - Bug report";
	var links = $("divBtns").getElementsByTagName("a");
	if(currPage > -1){
		links[currPage].className = links[currPage].className.split("Sel").join("");
	}
	links[4].className = links[4].className+"Sel";
	currPage = 4;
</script>

<div class="tituloPagina">
    Bug report
</div>

<div class="pageContent">

	<div class="txtBlock" style="width: 100%; clear: both;">
        <div class="formTitle">Form</div>
        <div style="margin-top: 30px; width: 100%; text-align: center;">
            <div class="form">
            	<div class="browsersArea">
                	<div id="browsersCont" class="browsersCont">
	                	<!--<div class="bChrome"></div>
                        <div class="bFirefox"></div>
                        <div class="bIE"></div>
                        <div class="bOpera"></div>
                        <div class="bSafari"></div>-->
                    </div>
                    <div id="bAba" class="bAbaTop"></div>
                </div>
	            <div class="large">
                	<textarea id="txtDescription" onkeyup="this.edited=1; storeTxt();">Description</textarea>
                </div>
            	<div class="small"><input type="text" id="txtName" value="Name" /></div>
                <div class="small" style="margin-top: 3px;"><input type="text" id="txtEmail" value="E-mail" /></div>
                <div class="medium" style="margin-top: 3px;">
                	<div class="capt" style=" margin-top: 4px; width: 90%; font-size: 13px;">Resource</div>
                    <select multiple="multiple" id="resourcesList"></select>
                </div>
            </div>
            <div class="form" style="margin-top: 20px;">
            	<div id="resultMsg" style="float: left;"></div>
            	<div id="submitBtn" class="botao" style="float: right;" onmousedown="this.className='botaoDown'; return false;" onmouseup="this.className='botao';">
                    <div class="btnSubmit"></div>
                </div>
            </div>
        </div>
        
    </div>

</div>

<script>

var fields = ['txtName', 'txtEmail'];
for(var i=0;i<fields.length;i++){
	var elem = $(fields[i]);
	elem.onfocus = function(){
		if(!this.firstValue){
			this.firstValue = this.value;
			this.value = "";
			this.style.color = "#000000";
		}
	}
	elem.onblur = function(){
		if(this.value.length == 0){
			this.value = this.firstValue;
			this.firstValue = null;
			this.style.color = "#CCCCCC";
		}
	}
}


$("txtDescription").onfocus = function(){
	this.style.color = "#000000";
	if((!descs[this.text] || descs[this.text] == '') && !this.edited){
		this.value = "";
	}
}

$("txtDescription").onblur = function(){
	if(this.value.length == 0){
		this.edited = 0;
		fixDescription();
		this.style.color = "#CCCCCC";
	}
}

window.putErrors = function(msgs){
	var out = '<ul class="warningList">';
	for(var i=0;i<msgs.length;i++){
		out += '<li>'+msgs[i]+'</li>';
	}
	out += "</ul>";
	$("resultMsg").innerHTML = out;
}

window.clearErrors = function(){
	$("resultMsg").innerHTML = '';
}

var xml = newXML("./docs/docsIndex.xml");
var resources = xml.getElementsByTagName("entry");
for(var i=0;i<resources.length;i++){
	var res = resources[i].getElementsByTagName("name")[0].childNodes[0].nodeValue;
	var elem = document.createElement("option");
	elem.setAttribute("value", res);
	elem.appendChild(document.createTextNode(res));
	$("resourcesList").appendChild(elem);
}

window.validateBugReportForm = function(){
	var errors = [];
	if($("txtName").value.length < 3 || $("txtName").value.toLowerCase() == "name") errors.push("The name is too short");
	if(!validaEmail($("txtEmail").value)) errors.push("Invalid e-mail");
	var descError = false;
	for(var i in descs){
		if(!descError){
			if(descs[i].length < 3) errors.push("At least one description should be filled correctly");
			descError = true;
		}
	}
	if($("resourcesList").selectedIndex < 0) errors.push("At least one resource should be selected");
	putErrors(errors);
	return errors.length==0;
}

$("submitBtn").onclick = function(){
	if(validateBugReportForm()){
		openLightBox(TIPO_HTML, "<div style='min-width: 250px; min-height: 80px;'><h1>Report summary goes here</h1>Your report has been sent successfully.</div>");
	}
}

var nomes = ["Chrome", "Firefox", "Internet Explorer", "Opera", "Safari", "Other"];
var ordem = ["Chrome", "Firefox", "IE", "Opera", "Safari"];
var descs = new Object();
descs['-1'] = '';
var positions = [183, 147, 111, 75, 43];
var selectedBrowser = 0;

window.putBrowsers = function(){
	var index = 0;
	var userAgent = navigator.userAgent.toLowerCase();
	var temp;
	var htmlOut = '';
	
	if(userAgent.indexOf("chrome") > -1){
		index = 0;
	} else if(userAgent.indexOf("firefox") > -1){
		index = 1;
	} else if(userAgent.indexOf("msie") > -1){
		index = 2;
	} else if(userAgent.indexOf("opera") > -1){
		index = 3;
	} else if(userAgent.indexOf("safari") > -1 && userAgent.indexOf("chrome") == -1){ //verificando a ausencia de "chrome", pois no caso do chrome, aparece "safari"
		index = 4;
	} else {
		index = -1;
	}
	if(index > -1){
		temp = ordem[0];
		ordem[0] = ordem[index];
		ordem[index] = temp;
	}
	index = index>-1?index:5;
	temp = nomes[0];
	nomes[0] = nomes[index];
	nomes[index] = temp;
	for(var i=0;i<ordem.length;i++){
		htmlOut += '<div class="b'+ordem[i]+'" id="b'+ordem[i]+'" onclick="selectBrowser('+i+');" title="'+nomes[i]+'"></div>';
	}
	$("browsersCont").innerHTML = htmlOut;
} ();

window.selectBrowser = function(pos){
	$("txtDescription").edited = 0;
	if($("txtDescription").style.color == "#CCCCCC" || $("txtDescription").style.color == '' || $("txtDescription").style.color == 'rgb(204, 204, 204)'){
		descs[String(selectedBrowser)] = '';
	} else {
		storeTxt();
	}
	
	if(pos != selectedBrowser){
		$("bAba").style.display = "inline-block";
		if(pos == 0) $("bAba").className = "bAbaTop";
		else if(pos == 4) $("bAba").className = "bAbaBottom";
		else $("bAba").className = "bAbaMiddle";
		$("bAba").style.top = "-"+positions[pos]+"px";
		selectedBrowser = pos;
	} else {
		$("bAba").style.display = "none";
		selectedBrowser = -1;
	}
	
	updateText();
}

window.updateText = function(){
	var theTxt = descs[String(selectedBrowser)];
	if(theTxt && theTxt.length > 0){
		$("txtDescription").value = theTxt;
		$("txtDescription").style.color = "#000000";
	} else {
		$("txtDescription").style.color = "#CCCCCC";
		fixDescription();
	}
	$("txtDescription").text = String(selectedBrowser);
}

window.fixDescription = function(){
	$("txtDescription").value = "Description ("+nomes[selectedBrowser==-1?5:selectedBrowser]+")";
}

window.storeTxt = function(){
	descs[String(selectedBrowser)] = $("txtDescription").value;
}

updateText();

</script>